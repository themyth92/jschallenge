!function(a){"use strict";a.module("app.core",["uiGmapgoogle-maps","ui.bootstrap","ui.router"])}(angular),angular.module("app.core").run(["$templateCache",function(a){"use strict";a.put("/js/components/bookingTimer.tpl.html",'<div class=timepicker><fieldset class=pull-left ng-disabled=disabled><timepicker ng-change=changeBookingStart() ng-model=booking.startDate template-url=/js/components/timepicker.tpl.html></timepicker></fieldset><span class="to pull-left">To</span><fieldset class=pull-left ng-disabled=disabled><timepicker ng-change=changeBookingEnd() class=pull-left ng-model=booking.endDate template-url=/js/components/timepicker.tpl.html></timepicker></fieldset><div class=clearfix></div><hr><div class="row total"><div class=col-md-3><h3><strong>Total:</strong></h3></div><div class=col-md-9><h2 class=pull-right><span ng-bind=booking.price></span>&nbsp;SGD</h2></div></div></div>'),a.put("/js/components/carParkRemoveModal.tpl.html",'<div class="modal-header text-center"><button type=button class=close ng-click=CarParkRemoveModalController.cancel()><span>×</span><span class=sr-only>Close</span></button><h4 class=modal-title>Confirmation</h4></div><div class=modal-body><p>Are you sure you want to delete this booking ? This action <strong>CANNOT</strong> be undone</p></div><div class=modal-footer><button class="btn btn-danger" ng-click=CarParkRemoveModalController.confirm() ng-disabled=CarParkRemoveModalController.view.disabled>Confirm</button> <button class="btn btn-default" ng-click=CarParkRemoveModalController.cancel() ng-disabled=CarParkRemoveModalController.view.disabled>Cancel</button></div>'),a.put("/js/components/readmore.tpl.html",'<span ng-if="text.length > limit"><span ng-hide=fullText><span ng-bind="text | limitTo:limit"></span>... <a ng-click=toggle() ng-bind=::moreText></a></span> <span ng-show=fullText><span ng-bind=text></span> <a ng-click=toggle()><u ng-bind=::lessText></u></a></span></span> <span ng-if="text.length <= limit" ng-bind=::text></span>'),a.put("/js/components/spinner.tpl.html",'<div class=sk-fading-circle><div class="sk-circle1 sk-circle"></div><div class="sk-circle2 sk-circle"></div><div class="sk-circle3 sk-circle"></div><div class="sk-circle4 sk-circle"></div><div class="sk-circle5 sk-circle"></div><div class="sk-circle6 sk-circle"></div><div class="sk-circle7 sk-circle"></div><div class="sk-circle8 sk-circle"></div><div class="sk-circle9 sk-circle"></div><div class="sk-circle10 sk-circle"></div><div class="sk-circle11 sk-circle"></div><div class="sk-circle12 sk-circle"></div></div>'),a.put("/js/components/timepicker.tpl.html",'<table><tbody><tr class=text-center ng-show=::showSpinners><td><a ng-click=incrementHours() ng-class="{disabled: noIncrementHours()}" class="btn btn-link"><span class="glyphicon glyphicon-chevron-up"></span></a></td></tr><tr><td class=form-group ng-class="{\'has-error\': invalidHours}"><input style=width:50px ng-model=hours ng-change=updateHours() class="form-control text-center" ng-readonly=::readonlyInput maxlength=2></td><td ng-show=showMeridian style=padding-left:5px><button type=button ng-class="{disabled: noToggleMeridian()}" class="btn btn-primary text-center" ng-click=toggleMeridian()>{{meridian}}</button></td></tr><tr class=text-center ng-show=::showSpinners><td><a ng-click=decrementHours() ng-class="{disabled: noDecrementHours()}" class="btn btn-link"><span class="glyphicon glyphicon-chevron-down"></span></a></td><td ng-show=showMeridian></td></tr></tbody></table>'),a.put("/js/layouts/pageSwitcher.tpl.html",'<span class=page-switcher-wrapper><spinner ng-if=pageLoading></spinner><div ng-show="!pageLoading && pageLoadedSuccess" ng-transclude></div></span>'),a.put("/js/layouts/topnav.tpl.html",'<div class="row border-bottom"><nav class="navbar navbar-static-top" role=navigation><div class=navbar-header><a class=navbar-brand href="/">S</a></div><ul class="nav navbar-top-links navbar-right"><li dropdown><a href dropdown-toggle class=user-menu><img src="/assets/avatar.jpg"> <span>Guest</span></a><ul class=dropdown-menu><li><a href="/"><i class="dropdown-icon fa fa-home"></i>&nbsp;&nbsp;Home</a></li><li><a href=/bookings><i class="dropdown-icon fa fa-cog"></i>&nbsp;&nbsp;Manage booking</a></li></ul></li></ul></nav></div>'),a.put("/js/pages/bookingEdit/bookingEdit.tpl.html",'<div class="modal in page-booking-edit" style="display: block"><div class=modal-dialog><div class=modal-content><div class=modal-header><button type=button class=close ng-click=BookingEditController.cancel()><span>×</span><span class=sr-only>Close</span></button><h1 class="modal-title text-center" ng-bind=BookingEditController.model.parking_shortname></h1></div><div class=modal-body><booking-timer booking=BookingEditController.data.booking price={{BookingEditController.model.pricePerHour}} disabled></booking-timer></div><div class=modal-footer><button class="btn btn-primary pull-left" ng-click=BookingEditController.confirm() ng-disabled=BookingEditController.view.isSubmitting>Confirm</button> <button class="btn btn-default pull-left" ng-click=BookingEditController.cancel() ng-disabled=BookingEditController.view.isSubmitting>Cancel</button> <button class="btn btn-danger pull-right" ng-click=BookingEditController.remove() ng-disabled=BookingEditController.view.isSubmitting>Remove</button></div></div></div></div><div class="modal-backdrop fade in"></div>'),a.put("/js/pages/bookings/bookings.tpl.html",'<div class="page-booking container"><div class=row><div class=col-lg-12><div class=panel><div class=panel-title><h1>Yours booking</h1></div><div class=panel-content><table class="table table-striped" ng-if="BookingsController.data.bookArr.length > 0"><thead><tr><th>#</th><th>Car park</th><th>Booking date</th><th>Booking time</th><th>Action</th></tr></thead><tbody><tr ng-repeat="book in BookingsController.data.bookArr"><td ng-bind="$index + 1"></td><td ng-bind=book.parking_shortname></td><td><i ng-bind="book.booking.startDate | date: \'EEE, MMM d, y\'"></i></td><td><strong><span ng-bind="book.booking.startDate | date: \'h a\'"></span></strong><span>&nbsp;&nbsp;-&nbsp;&nbsp;</span><strong><span ng-bind="book.booking.endDate | date: \'h a\'"></span></strong></td><td><a class="btn btn-primary" ui-sref="base.bookings.edit({carParkID : book.id})"><i class="fa fa-edit"></i>&nbsp;Edit</a></td></tr></tbody></table><div ng-if="BookingsController.data.bookArr.length == 0"><h4><i>You dont have any bookings at the moment !</i></h4></div></div></div></div></div><div ui-view></div></div>'),a.put("/js/pages/carParks/carParkDetails.tpl.html",'<div class=car-park-details-wrapper ng-if=view.showPanel><div class=panel><div class="panel-title text-center" ng-class="{unavailable : view.showBookingPanel && model.cars_available == 0}"><div class=panel-tools><a class=close ng-click=close()><i class="fa fa-times"></i></a></div><h1 ng-bind=model.parking_shortname></h1><small><i><span ng-class="{\'text-navy\' : model.cars_available > 0, \'text-danger\' : model.cars_available == 0}"><span ng-bind=model.cars_available></span> cars available</span> on <span ng-bind="data.tomorrow | date : \'EEE, MMM d, y\'"></span></i></small></div><hr class=star><div class="panel-content text-left"><div><h3><span class="fa fa-map"></span>&nbsp;&nbsp;How to get there</h3><p class=text-muted><readmore text={{model.description}}></readmore></p></div><hr><div ng-if=!view.showBookingPanel><h3><span class="fa fa-calendar"></span>&nbsp;&nbsp;Your booking</h3><div ng-if=!view.showBookingTimer><strong><span ng-bind="model.booking.startDate | date: \'h a\'"></span></strong>&nbsp;&nbsp;To&nbsp;&nbsp; <strong><span ng-bind="model.booking.endDate | date: \'h a\'"></span></strong> <span>&nbsp;&nbsp;</span> <span ng-click=openBookingTimer() style=cursor:pointer><u><i>Change</i></u></span></div></div><div ng-if=view.showBookingPanel><h3><span class="fa fa-bookmark"></span>&nbsp;&nbsp;Book this place</h3><button ng-if="!view.showBookingTimer && model.cars_available > 0" class="btn btn-primary btn-outline" ng-click=openBookingTimer()>Book</button> <span ng-if="model.cars_available == 0"><i>Sorry. No cars available at the moment<i></i></i></span></div><booking-timer ng-if=view.showBookingTimer booking=data.booking price={{model.pricePerHour}} disabled></booking-timer><div ng-if=view.showBookingTimer><button class="btn btn-primary" ng-disabled=view.isBookingSubmit ng-click=confirm()>Confirm</button> <button class="btn btn-default" ng-disabled=view.isBookingSubmit ng-click=cancel()>Cancel</button> <button ng-if=!view.showBookingPanel class="btn btn-danger pull-right" ng-disabled=view.isBookingSubmit ng-click=remove()>Remove</button></div></div></div></div>'),a.put("/js/pages/carParks/carParks.tpl.html","<div class=page-carpark><div class=map-wrapper><ui-gmap-google-map class=map-canvas center=CarParksController.data.map.center zoom=CarParksController.data.map.zoom map-adjust><ui-gmap-markers coords=\"'self'\" models=CarParksController.data.markerArr fit=\"'true'\" icon=\"'maps.google.com/mapfiles/marker.png'\" click=CarParksController.selectCarPark></ui-gmap-markers></ui-gmap-google-map></div><car-park-details></car-park-details></div>")}]),function(a,b){"use strict";function c(){function a(a){b.map(a,function(a){a.booking={startDate:null,endDate:null},a.pricePerHour=10,a.cars_available=b.parseInt(a.cars_available)}),d.model=a}function c(a){return b.find(d.model,function(b){return b.id.toString()===a.toString()})}var d={processCarParkArr:a,findCarPark:c};return d.model=[],d.data={appLoaded:!1},d}a.module("services.appData",[]).factory("appData",c)}(angular,_),function(a){"use strict";function b(a,b){function c(){return b.data.appLoaded?void 0:a.get("/api/v1/carparks").success(function(a){b.data.appLoaded=!0,b.processCarParkArr(a)}).error(function(a){console.log(a)})}var d={baseRoute:c};return d}a.module("services.routeResolver",["services.appData"]).factory("routeResolver",b),b.$inject=["$http","appData"]}(angular),function(a,b){"use strict";function c(){function a(a){var c=[];return b.map(a,function(a){var b=a.latitude,d=a.longitude,e=a.id;c.push({id:e,latitude:b,longitude:d})}),c}function c(){return{center:{latitude:45,longitude:-73},zoom:16}}var d={buildMarkerArr:a,buildMap:c};return d}a.module("services.map",[]).factory("map",c)}(angular,_),function(a){"use strict";function b(){function a(){var a=new Date;return a.setDate(a.getDate()+1),a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0),a}function b(a){return a.toISOString()}var c={getDefaultTomorrow:a,toISOString:b};return c}a.module("services.util",[]).factory("util",b)}(angular),function(a){"use strict";function b(){function a(a,b,c){var d=c.spinRadius||11;b.css({width:2*d+"px",height:2*d+"px"})}var b={link:a,templateUrl:"/js/components/spinner.tpl.html",restrict:"E",replace:!0};return b}a.module("components.spinner",["app.core"]).directive("spinner",b)}(angular),function(a){"use strict";function b(){function a(a,b,c){function d(){a.fullText=!a.fullText}var e=c.limit||50,f=c.moreText||"Read more",g=c.lessText||"Less";a.limit=e,a.moreText=f,a.lessText=g,a.fullText=!1,a.toggle=d}var b={link:a,templateUrl:"/js/components/readmore.tpl.html",restrict:"E",scope:{text:"@"}};return b}a.module("components.readmore",["app.core"]).directive("readmore",b)}(angular),function(a,b){"use strict";function c(a){function c(c){function d(){var d=c.booking.startDate,e=c.booking.endDate;if(b.isDate(d)&&b.isDate(e)){var g=d.getHours(),h=e.getHours();if(g>h){var i=a.getDefaultTomorrow();i.setHours(g),c.booking.endDate=i,g=h}f(g,h)}}function e(){var d=c.booking.startDate,e=c.booking.endDate;if(b.isDate(d)&&b.isDate(e)){var g=d.getHours(),h=e.getHours();if(g>h){var i=a.getDefaultTomorrow();i.setHours(h),c.booking.startDate=i,g=h}f(g,h)}}function f(a,b){c.booking.price=(b-a)*c.price}c.changeBookingStart=d,c.changeBookingEnd=e}var d={link:c,templateUrl:"/js/components/bookingTimer.tpl.html",scope:{booking:"=",disabled:"=",price:"@"},restrict:"E",replace:!0};return d}a.module("components.bookingTimer",["app.core","services.util"]).directive("bookingTimer",c),c.$inject=["util"]}(angular,_),function(a){"use strict";function b(a,b){function c(){return e.view.disabled=!0,b(function(){e.view.disabled=!1,a.close()},1e3)}function d(){a.dismiss()}var e=this;e.confirm=c,e.cancel=d,e.view={disabled:!1}}a.module("components.carParkRemoveModal",["app.core"]).controller("CarParkRemoveModalController",b),b.$inject=["$modalInstance","$timeout"]}(angular),function(a){"use strict";function b(){var a={restrict:"E",templateUrl:"/js/layouts/topnav.tpl.html",replace:!0};return a}a.module("layouts.topnav",["app.core"]).directive("topnav",b)}(angular),function(a){"use strict";function b(a){function b(a,b){function c(){a.$on("$stateChangeStart",d),a.$on("$stateChangeError",e),a.$on("$stateChangeSuccess",f)}function d(){a.pageLoading=!0,a.pageLoadedSuccess=!1}function e(a,b,c,d,e,f){}function f(){a.pageLoading=!1,a.pageLoadedSuccess=!0}a.pageLoading=!0,a.pageLoadedSuccess=!1,c()}var c={link:b,templateUrl:"/js/layouts/pageSwitcher.tpl.html",replace:!0,transclude:!0,scope:{},restrict:"E"};return c}a.module("layouts.pageSwitcher",["app.core"]).directive("pageSwitcher",b),b.$inject=["$state"]}(angular),function(a){"use strict";function b(b,c){function d(d,e){function f(){g()}function g(){var a=h.offsetHeight;e.css("min-height",a+"px")}var h=b[0].body,i=a.element(c);g(),i.bind("resize",f)}var e={link:d,restrict:"A"};return e}a.module("layouts.pageWrapperAdjust",[]).directive("pageWrapperAdjust",b),b.$inject=["$document","$window"]}(angular),function(a){"use strict";a.module("pages.base",["app.core","services.routeResolver"])}(angular),function(a){"use strict";function b(a){a.state("base",{url:"","abstract":!0,template:"<ui-view/>",resolve:{baseRouteResolver:c}})}function c(a){return a.baseRoute()}a.module("pages.base").config(b),b.$inject=["$stateProvider"],c.$inject=["routeResolver"]}(angular),function(a){"use strict";a.module("pages.carParks",["app.core","services.appData","services.map","services.util","components.readmore","components.bookingTimer","components.carParkRemoveModal"])}(angular),function(a){"use strict";function b(a){a.state("base.carParks",{url:"/",templateUrl:"/js/pages/carParks/carParks.tpl.html",controller:"CarParksController",controllerAs:"CarParksController"})}a.module("pages.carParks").config(b),b.$inject=["$stateProvider"]}(angular),function(a){"use strict";function b(a,b,c){function d(b,c,d){var e=d.id;a.$broadcast("event::carParkSelect",{carParkID:e})}var e=this;e.model=b.model,e.data={markerArr:c.buildMarkerArr(b.model),map:c.buildMap()},e.selectCarPark=d}a.module("pages.carParks").controller("CarParksController",b),b.$inject=["$scope","appData","map"]}(angular),function(a){"use strict";function b(b,c){function d(d,e){function f(){g()}function g(){var a=i.offsetHeight,b=l.offsetHeight,c=a-b-1;j.css("height",c+"px")}function h(){k.unbind("resize",g)}var i=b[0].body,j=a.element(e[0].querySelector(".angular-google-map-container")),k=a.element(c),l=a.element(i.querySelector(".navbar"))[0];g(),k.bind("resize",f),d.$on("$destroy",h)}var e={link:d,restrict:"A"};return e}a.module("pages.carParks").directive("mapAdjust",b),b.$inject=["$document","$window"]}(angular),function(a,b){"use strict";function c(a,c,d,e){function f(f,g){function h(a,b){var c=b.carParkID;f.view.showPanel=!0,f.model=d.findCarPark(c),o(),n()}function i(){f.view.showBookingTimer=!0}function j(){var c=f.data.booking.startDate,d=f.data.booking.endDate,g=f.data.booking.price;return b.isDate(c)&&b.isDate(d)&&g>0?(f.view.isBookingSubmit=!0,a(function(){f.model.booking.startDate=e.toISOString(c),f.model.booking.endDate=e.toISOString(d),f.view.showBookingPanel&&(f.model.cars_available-=1),o()},1e3)):void 0}function k(){o(),n()}function l(){p()}function m(){f.data.modalInstance=c.open({size:"sm",templateUrl:"/js/components/carParkRemoveModal.tpl.html",controller:"CarParkRemoveModalController as CarParkRemoveModalController"}),f.data.modalInstance.result.then(function(){f.model.booking.startDate=null,f.model.booking.endDate=null,f.model.cars_available+=1,n(),o()})}function n(){if(null!==f.model.booking.startDate&&null!==f.model.booking.endDate)f.data.booking.startDate=new Date(f.model.booking.startDate),f.data.booking.endDate=new Date(f.model.booking.endDate),f.data.booking.price=(f.data.booking.endDate.getHours()-f.data.booking.startDate.getHours())*f.model.pricePerHour;else{var a=e.getDefaultTomorrow();f.data.booking.startDate=a,f.data.booking.endDate=a,f.data.booking.price=0}f.data.modalInstance=null}function o(){null!==f.model.booking.startDate&&null!==f.model.booking.endDate?f.view.showBookingPanel=!1:f.view.showBookingPanel=!0,f.view.showBookingTimer=!1,f.view.isBookingSubmit=!1}function p(){f.model={},f.view={showPanel:!1,showBookingTimer:!1,showBookingPanel:!1,isBookingSubmit:!1},f.data={tomorrow:e.getDefaultTomorrow(),booking:{startDate:null,endDate:null,price:null},modalInstance:null}}f.openBookingTimer=i,f.confirm=j,f.cancel=k,f.close=l,f.remove=m,f.$on("event::carParkSelect",h),p()}var g={link:f,templateUrl:"/js/pages/carParks/carParkDetails.tpl.html",restrict:"E",replace:!0};return g}a.module("pages.carParks").directive("carParkDetails",c),c.$inject=["$timeout","$modal","appData","util"]}(angular,_),function(a){"use strict";a.module("pages.bookings",["app.core","services.appData"])}(angular),function(){"use strict";function a(a){a.state("base.bookings",{url:"/bookings",templateUrl:"/js/pages/bookings/bookings.tpl.html",controller:"BookingsController",controllerAs:"BookingsController"})}angular.module("pages.bookings").config(a),a.$inject=["$stateProvider"]}(angular),function(a,b){"use strict";function c(a){function c(){return b.reduce(a.model,function(a,b,c){return null!==b.booking.startDate&&null!==b.booking.endDate&&a.push(b),a},[])}var d=this;d.data={bookArr:c()}}a.module("pages.bookings").controller("BookingsController",c),c.$inject=["appData"]}(angular,_),function(a){"use strict";a.module("pages.bookingEdit",["app.core","components.bookingTimer","services.util","components.carParkRemoveModal"])}(angular),function(){"use strict";function a(a){a.state("base.bookings.edit",{url:"/:carParkID/edit",templateUrl:"/js/pages/bookingEdit/bookingEdit.tpl.html",controller:"BookingEditController",controllerAs:"BookingEditController"})}angular.module("pages.bookingEdit").config(a),a.$inject=["$stateProvider"]}(angular),function(a,b){"use strict";function c(a,c,d,e,f,g){function h(){c.go("base.bookings")}function i(){var a=l.data.booking.startDate,e=l.data.booking.endDate,f=l.data.booking.price;return b.isDate(a)&&b.isDate(e)&&f>0?(l.view.isSubmitting=!0,d(function(){l.model.booking.startDate=g.toISOString(a),l.model.booking.endDate=g.toISOString(e),l.view.isSubmitting=!1,c.go("base.bookings")},1e3)):void 0}function j(){l.data.modalInstance=e.open({size:"sm",templateUrl:"/js/components/carParkRemoveModal.tpl.html",controller:"CarParkRemoveModalController as CarParkRemoveModalController"}),l.data.modalInstance.result.then(function(){l.model.booking.startDate=null,l.model.booking.endDate=null,l.model.cars_available+=1,c.go("base.bookings",{},{reload:!0})})}var k=a.carParkID,l=this;l.cancel=h,l.confirm=i,l.remove=j,l.model=f.findCarPark(k),l.view={isSubmitting:!1},l.data={booking:{}},l.data.booking.startDate=new Date(l.model.booking.startDate),l.data.booking.endDate=new Date(l.model.booking.endDate),l.data.booking.price=(l.data.booking.endDate.getHours()-l.data.booking.startDate.getHours())*l.model.pricePerHour,l.data.modalInstance=null}a.module("pages.bookingEdit").controller("BookingEditController",c),c.$inject=["$stateParams","$state","$timeout","$modal","appData","util"]}(angular,_),function(a){"use strict";function b(a){a.configure({v:"3.20"})}a.module("app",["app.core","components.spinner","layouts.topnav","layouts.pageSwitcher","layouts.pageWrapperAdjust","pages.base","pages.carParks","pages.bookings","pages.bookingEdit"]).config(b),b.$inject=["uiGmapGoogleMapApiProvider"],setTimeout(function(){a.bootstrap(document,["app"],{strictDi:!0})},1e3)}(angular),function(a){"use strict";function b(a,b){b.html5Mode(!0),a.otherwise("/")}a.module("app").config(b),b.$inject=["$urlRouterProvider","$locationProvider"]}(angular);